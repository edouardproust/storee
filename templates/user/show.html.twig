{% extends 'default.html.twig' %}

{% set u = app.user %}
{% set title = "Hello " ~ u.firstname ~ " " ~ u.lastname %}

{% block content %}

    <h3>My orders</h3>
    {% if purchases | length <= 0 %}
        No orders yet.
    {% else %}
        <table class="table">
        <tr>
            <th scope="col">Order Nr.</th>
            <th scope="col">Date</th>
            <th scope="col">Products</th>
            <th scope="col">Total</th>
            <th scope="col">Delivery</th>
            <th scope="col">Address</th>
            <th scope="col">Payment Status</th>
        </tr>
        {% for purchase in purchases %}
            <tr>
                <td>{{ purchase.id }}</td>
                <td>{{ purchase.createdAt | date("m/d/Y") }}</td>
                <td>
                    {% for item in purchase.purchaseItems %}
                        {% set data = accountService.getProductData(item) %}
                        <div>{{ item.quantity }}x {{ data.name }} ({{ item.total|price }})</div>
                    {% endfor %}
                </td>
                <td>{{ purchase.total|price }}</td>
                <td>{{ purchase.delivery.name }}</td>
                <td class="small">
                    {% set data = accountService.getUserData(purchase) %}
                    <div>{{ data.firstname }} {{ data.lastname }}</div>
                    <div>{{ data.street }}</div>
                    <div>{{ data.postcode }} {{ data.city }}</div>
                    <div>{{ data.country }}</div>
                    <div><i class="me-2 fas fa-phone fa-sm"></i>{{ data.phone }}</div>
                </td>
                <td>{{ purchase.status|lower|capitalize }}
                    {% if purchase.status is same as checkoutService.getPaymentStatusConst('pending') %}
                        <div class="mt-2">
                            <a href="#" class="btn btn-primary btn-sm">
                                <i class="fas fa-credit-card me-1"></i> Pay now
                            </a>
                        </div>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </table>
    {% endif %}

    <h3>My informations</h3>
    {{ form_start(userForm) }}
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                <div class="col-sm-6">{{ form_row(userForm.email) }}</div>
                <div class="col-sm-6">{{ form_row(userForm.password) }}</div>
            </div>
            <div class="row">
                <div class="col-sm-6">{{ form_row(userForm.firstname) }}</div>
                <div class="col-sm-6">{{ form_row(userForm.lastname) }}</div>
            </div>
            {{ form_row(userForm.street) }}
            <div class="row">
                <div class="col-sm-6">{{ form_row(userForm.postcode) }}</div>
                <div class="col-sm-6">{{ form_row(userForm.city) }}</div>
            </div>
            {{ form_row(userForm.country) }}
            {{ form_row(userForm.phone) }}
        </div>
    </div>
    <button type="submit" class="btn btn-primary text-left">Update my informations</button>
    {{ form_end(userForm) }}

{% endblock %}